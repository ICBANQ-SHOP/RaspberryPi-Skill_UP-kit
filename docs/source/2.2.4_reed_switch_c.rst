2.2.4 Reed Switch Module
========================

Introduction
-------------------

In this lesson, we will learn about the reed switch, which is an electrical switch that operates by means of an applied magnetic field.

.. image:: media/2.2.4reed_switch.png
    :width: 300
    :align: center

Components
----------------

.. image:: media/2.2.4component.png
    :width: 700
    :align: center

Principle
----------------

Reed switch, also known as a magnetic switch or reed switch.

It has two internal metal reeds, sealed in a glass tube, which is filled with inert gas. Normally the two reeds overlap each other, but are separated by a gap, and the circuit is broken. When there is a magnetic object close to the two reeds will produce a mutual attraction of the magnetic force, which will be sucked together, the circuit is connected. Therefore, the reed switch can be used to make a magnetic sensor.

.. image:: media/HowItWorksReed.jpg

The reed switch module consists of a reed switch, potentiometer, LM393 comparator, LED, etc. The internal circuit is shown below, when the magnet is close to the module, it will be on, and the module will output low level; when there is no magnetism, it will be off, and output high level. Reed switch and magnet induction distance should be within 1.5cm, beyond will not be sensitive or no trigger phenomenon, you can also adjust the sensitivity through the potentiometer on the module.

.. image:: media/reedswitch_sche.jpg


Visit: https://en.wikipedia.org/wiki/Reed_switch, for more information.

Schematic Diagram
-----------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO27       Pin 13   2        27
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: media/reed_schematic.png
    :width: 400
    :align: center

.. image:: media/reed_schematic2.png
    :width: 400
    :align: center

Experimental Procedures
-------------------------------

**Step 1:** Build the circuit.

.. image:: media/2.2.4fritzing.png
    :width: 700
    :align: center

**Step 2:** Change directory.

.. code-block::

    cd /home/pi/raphael-kit/c/2.2.4/

**Step 3:** Compile.

.. code-block::

    gcc 2.2.4_ReedSwitch.c -lwiringPi

**Step 4:** Run.

.. code-block::

    sudo ./a.out

The green LED will light up when the code is run. If a magnet is placed close to the reed switch module, the red LED lights up; take away the magnet and the green LED lights up again.

**Code**

.. code-block:: c

    #include <wiringPi.h>
    #include <stdio.h>

    #define ReedPin		0
    #define Gpin		2
    #define Rpin		3

    void LED(char* color)
    {
        pinMode(Gpin, OUTPUT);
        pinMode(Rpin, OUTPUT);
        if (color == "RED")
        {
            digitalWrite(Rpin, HIGH);
            digitalWrite(Gpin, LOW);
        }
        else if (color == "GREEN")
        {
            digitalWrite(Rpin, LOW);
            digitalWrite(Gpin, HIGH);
        }
        else
            printf("LED Error");
    }

    int main(void)
    {
        if(wiringPiSetup() == -1){ //when initialize wiring failed,print messageto screen
            printf("setup wiringPi failed !");
            return 1; 
        }

        pinMode(ReedPin, INPUT);
        LED("GREEN");
        
        while(1){
            if(0 == digitalRead(ReedPin)){
                delay(10);
                if(0 == digitalRead(ReedPin)){
                    LED("RED");	
                    printf("Detected Magnetic Material!\n");	
                }
            }
            else if(1 == digitalRead(ReedPin)){
                delay(10);
                if(1 == digitalRead(ReedPin)){
                    while(!digitalRead(ReedPin));
                    LED("GREEN");
                }
            }
        }
        return 0;
    }

**Code Explanation**

.. code-block::

    #define ReedPin		0
    #define Gpin		2
    #define Rpin		3

Pin GPIO17, GPIO27 and GPIO22 of the T_Extension Board is corresponding to 
the GPIO0, GPIO2 and GPIO3 in wiringPi. Assign GPIO0, GPIO2 and GPIO3 to 
``ReedPin``, ``Gpin`` and ``Rpin``.

.. code-block::

    void LED(char* color)
    {
        pinMode(Gpin, OUTPUT);
        pinMode(Rpin, OUTPUT);
        if (color == "RED")
        {
            digitalWrite(Rpin, HIGH);
            digitalWrite(Gpin, LOW);
        }
        else if (color == "GREEN")
        {
            digitalWrite(Rpin, LOW);
            digitalWrite(Gpin, HIGH);
        }
        else
            printf("LED Error");
    }

Set a ``LED()`` function to control the 2 LEDs, the parameter of this function is ``color``.

When ``color`` is ``"RED"``, set ``Rpin`` to ``HIGH`` (light up the red LED) and ``Gpin`` to ``LOW`` (turn off the green LED); when ``color`` is ``"GREEN"``, then light up the green LED and turn off the red LED. 

.. code-block::

    while(1){
            if(0 == digitalRead(ReedPin)){
                delay(10);
                if(0 == digitalRead(ReedPin)){
                    LED("RED");	
                    printf("Detected Magnetic Material!\n");	
                }
            }
            else if(1 == digitalRead(ReedPin)){
                delay(10);
                if(1 == digitalRead(ReedPin)){
                    while(!digitalRead(ReedPin));
                    LED("GREEN");
                }
            }
        }

Read the value of the reed switch module, if the value read 2 times is 0, call ``LED("RED")`` to light up the red LED and print ``"Magnetic material detected!"``.

If the value is 1, the green LED is lit.


Phenomenon Picture
------------------------

.. image:: media/2.2.4reed_switch.JPG
    :width: 500
    :align: center