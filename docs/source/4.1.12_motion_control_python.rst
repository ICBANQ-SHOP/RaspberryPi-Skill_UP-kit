4.1.12 Motion Control
~~~~~~~~~~~~~~~~~~~~

**Introduction**
-----------------

In this lesson, we will make a simple motion sensing and controlling
device. The MPU6050 is used as a sensor and the stepper motor as a
controlled device. With the MPU6050 mounted on the glove, you can
control the stepper motor by rotating your wrist.

**Components**
---------------

.. image:: media/list_Motion_Control.png
    :align: center

**Schematic Diagram**
--------------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO18       Pin 12   1        18
GPIO23       Pin 16   4        23
GPIO24       Pin 18   5        24
GPIO25       Pin 22   6        25
SDA1         Pin 3             
SCL1         Pin 5             
============ ======== ======== ===

.. image:: media/Schematic_three_one6.png
   :align: center

**Experimental Procedures**
------------------------------

**Step 1:** Build the circuit.

.. image:: media/image251.png
   :alt: 3.1.6 Motion Control_bb
   :width: 6.84792in
   :height: 3.93194in

**Step 2**: Go to the folder of the code.

.. code-block:: python

    cd /home/pi/raphael-kit/python/

**Step 3**: Run the executable file.

.. code-block:: python

    sudo python3 4.1.12_MotionControl.py

As the code runs, if the tilt angle of **mpu6050** on the
`Y <https://cn.bing.com/dict/search?q=Y&FORM=BDVSP6&mkt=zh-cn>`__\ **-**\ `axis <https://cn.bing.com/dict/search?q=axis&FORM=BDVSP6&mkt=zh-cn>`__
is larger than **45** ℃, the stepper motor rotates anticlockwise; if
less than **-45** ℃, the stepper motor rotates clockwise.

**Code Explanation**

.. code-block:: python

    def mpu6050():
        accel_xout = read_word_2c(0x3b)
        accel_yout = read_word_2c(0x3d)
        accel_zout = read_word_2c(0x3f)
        accel_xout_scaled = accel_xout / 16384.0
        accel_yout_scaled = accel_yout / 16384.0
        accel_zout_scaled = accel_zout / 16384.0
        angle=get_y_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled)
        return angle

mpu6050 gets the tilt angle in the direction of the Y-axis.

.. code-block:: python

    def rotary(direction):
        if(direction == 'c'):   
            for j in range(4):
                for i in range(4):
                    GPIO.output(motorPin[i],0x99>>j & (0x08>>i))
                time.sleep(stepSpeed)

        elif(direction == 'a'):
            for j in range(4):
                for i in range(4):
                    GPIO.output(motorPin[i],0x99<<j & (0x80>>i))
                time.sleep(stepSpeed)

If the received direction **key** is ‘\ **c**\ ’, the stepper motor
rotates clockwise; if the **key** is ‘\ **a**\ ’, the motor rotates
anticlockwise. Refer to **1.3.3 Stepper Motor** for more details about
the calculation of the rotating direction of the stepper motor.

.. code-block:: python

    def loop():
        while True:
            angle=mpu6050()
            if angle >=45 :
                rotary('a')
            elif angle <=-45:
                rotary('c')

The tilt angle in the direction of the **Y-axis** is read from
**mpu6050**, and if it’s larger than **45**\ ℃, rotary() is called to
let the stepper motor rotate anticlockwise; if less than **-45** ℃, the
stepper motor rotates clockwise.

**Phenomenon Picture**
-----------------------

.. image:: media/image252.jpeg
   :align: center